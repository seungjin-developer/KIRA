# Cleanup Patterns - 정리 패턴 및 LLM 판단 기준

이 문서는 메모리 정리 시 LLM이 판단해야 하는 기준과 패턴을 정의합니다.

## 핵심 원칙

1. **하드코딩 없음** - 보존 기간, 파일 수 임계치 등을 고정하지 않음
2. **컨텍스트 기반 판단** - 파일의 내용, 관계, 최근성을 종합적으로 고려
3. **안전 우선** - 확실하지 않으면 삭제보다 보존

## 정리 패턴

### Pattern 1: 중간 결과물 정리

**상황**: 같은 작업의 중간 결과와 최종 결과가 공존

**탐지 방법**:
```
파일명 패턴:
- 7개_이메일_분석_2025-12-08.md
- 8개_이메일_분석_2025-12-08.md
- 9개_이메일_분석_2025-12-08.md
- 10개_이메일_분석_2025-12-08.md  ← 최종

숫자가 증가하는 유사 파일명 = 중간 결과물
```

**액션**:
- 가장 큰 숫자/가장 완전한 내용의 파일만 유지
- 나머지는 삭제

**판단 포인트**:
- 파일명의 숫자 패턴
- 파일 크기 (더 큰 게 더 완전할 가능성)
- `updated` 타임스탬프 (더 최신이 최종일 가능성)

---

### Pattern 2: 버전 파일 정리

**상황**: `_v1`, `_v2`, `_v3` 버전 파일들

**탐지 방법**:
```
파일명 패턴:
- 프로젝트_계획.md
- 프로젝트_계획_v1.md
- 프로젝트_계획_v2.md
```

**액션**:
- 가장 높은 버전만 유지
- 또는 원본과 최신 버전만 유지

**판단 포인트**:
- 버전 간 내용 차이가 큰가?
- 이전 버전에만 있는 중요 정보가 있는가?

---

### Pattern 3: 시의성 지난 정보 정리

**상황**: 시간이 지나 가치가 하락한 정보

**탐지 방법**:
```yaml
# 메타데이터 확인
created: 2025-06-01  # 6개월 이상 전
updated: 2025-06-01  # 이후 업데이트 없음
tags: [news, announcement]  # 시의성 있는 태그
```

**후보 폴더**:
- `external/news/` - 뉴스는 시간 지나면 가치 하락
- `announcements/` - 오래된 공지
- `misc/` - 오래된 일상 대화

**액션**:
- 관련 프로젝트가 진행 중이면 보존
- 관련 프로젝트가 완료되었거나 없으면 삭제 고려

**판단 포인트**:
- `related_to`에 연결된 프로젝트 상태
- 최근 검색/참조된 적 있는가?
- 태그에 `important`, `reference` 등이 있는가?

---

### Pattern 4: 고아 파일 정리

**상황**: 어디에도 연결되지 않은 파일

**탐지 방법**:
```yaml
# 메타데이터에 연결 정보 없음
related_to: []
related_project: null
related_channel: null
```

**액션**:
- 내용 분석하여 연결 가능하면 연결
- 연결 불가하고 오래되었으면 삭제 고려

---

### Pattern 5: 실패 기록 정리

**상황**: 작업 실패 기록들

**탐지 방법**:
```
파일명 패턴:
- INZOI KPI 조회 실패 사례.md
- INZOI KPI 대시보드 조회 실패.md
- API 구내식당 메뉴 조회 실패.md
```

**액션**:
- 같은 실패 여러 개 → 1개로 통합
- 이후 성공했으면 실패 기록 삭제 가능
- 반복되는 실패 패턴이면 보존 (디버깅용)

**판단 포인트**:
- 같은 작업의 성공 기록이 있는가?
- 실패 원인이 해결되었는가?

---

## 폴더별 정리 우선순위

LLM이 정리할 때 다음 순서로 접근:

### 1순위: misc/
- 가장 먼저 정리
- 일상 대화, 분류 안 된 것들
- 오래된 것부터 검토

### 2순위: tasks/
- 완료된 작업 중 오래된 것
- 중간 결과물
- 중복 기록

### 3순위: external/news/
- 시의성 지난 뉴스
- 관련 프로젝트 완료된 것

### 4순위: announcements/
- 오래된 공지
- 일회성 이벤트

### 5순위: meetings/
- 오래된 회의록
- 액션 아이템 완료된 것

### 보존 우선: decisions/, projects/, users/, channels/
- 신중하게 접근
- 명확한 중복만 정리

---

## LLM 판단 체크리스트

파일 삭제/이동 전 다음을 확인:

### 삭제 전 체크
- [ ] 다른 파일에서 `related_to`로 참조하고 있지 않은가?
- [ ] 진행 중인 프로젝트와 관련 없는가?
- [ ] 최근 30일 이내 생성/수정되지 않았는가?
- [ ] 더 완전한 버전이 존재하는가?
- [ ] `important`, `reference` 태그가 없는가?

### 이동 전 체크
- [ ] 이동할 폴더가 더 적절한가?
- [ ] 메타데이터의 `type`과 일치하는가?
- [ ] 같은 파일명이 목적지에 없는가?

### 병합 전 체크
- [ ] 동일 entity인 것이 확실한가? (email, user_id 등)
- [ ] 양쪽 파일의 정보를 모두 보존했는가?
- [ ] 메타데이터도 적절히 병합했는가?

---

## 정리 결과 보고 템플릿

```markdown
## 메모리 정리 결과

### 요약
- 정리 전: {N}개 파일
- 정리 후: {M}개 파일
- 삭제: {X}개
- 이동: {Y}개
- 병합: {Z}개

### 상세 내역

#### 삭제된 파일
| 파일명 | 폴더 | 삭제 이유 |
|--------|------|-----------|
| ... | ... | 중복/중간결과/시의성 만료 |

#### 이동된 파일
| 파일명 | 원래 위치 | 새 위치 | 이동 이유 |
|--------|-----------|---------|-----------|
| ... | ... | ... | 오분류 |

#### 병합된 파일
| 원본 파일들 | 결과 파일 | 병합 이유 |
|-------------|-----------|-----------|
| ... | ... | 동일인 중복 |

### 주의사항
- 백업 위치: {backup_path}
- 롤백 필요 시 연락
```

---

## 예외 상황

### 절대 삭제하지 않는 것
- `index.md` (메인 인덱스)
- `.memory_metadata` (시스템 파일)
- `decisions/` 내 1년 이내 파일
- `important` 태그가 있는 파일

### 사용자 확인 필요한 것
- `projects/` 내 완료된 프로젝트
- 50개 이상 대량 삭제 시
- `users/`, `channels/` 파일 삭제 시 
